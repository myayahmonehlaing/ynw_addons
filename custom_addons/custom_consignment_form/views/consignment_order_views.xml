<odoo>
    <!-- Consignment Order Form View -->
    <record id="view_form_consignment_order" model="ir.ui.view">
        <field name="name">consignment.order.form</field>
        <field name="model">consignment.order</field>
        <field name="arch" type="xml">
            <form string="Consignment Order"
                  statusbar_visible="state"
                  statusbar_colors="{'draft': 'muted', 'confirmed': 'info', 'done': 'success', 'cancel': 'danger'}">

                <header>
                    <field name="state" widget="statusbar"/>
                    <button name="action_confirm" type="object" string="Confirm"
                            class="btn-primary" invisible="state!='draft'"/>
                    <button name="action_cancel" type="object" string="Cancel"
                            class="btn-secondary" invisible="state not in ('draft', 'confirmed')"/>
                </header>

                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="open_picking_view" type="object"
                                class="oe_stat_button" icon="fa-truck"
                                invisible="picking_count == 0">
                            <field name="picking_count" widget="statinfo" string="Transfers"/>
                        </button>

                        <button name="action_view_sale_orders" type="object"
                                class="oe_stat_button" icon="fa-shopping-cart"
                                invisible="sale_order_count == 0">
                            <field name="sale_order_count" widget="statinfo" string="Sale Orders"/>
                        </button>
                    </div>

                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                    </div>

                    <group>
                        <group>
                            <field name="partner_id"/>
                            <field name="pricelist_id"/>
                        </group>
                        <group>
                            <field name="picking_type_id"/>
                            <field name="date_order"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Order Lines">
                            <field name="order_line_ids" mode="list,form">
                                <list editable="bottom">
                                    <field name="product_id"/>
                                    <field name="product_uom_qty"/>
                                    <field name="sold_qty" readonly="1"/>
                                    <field name="remaining_qty" readonly="1"/>
                                    <field name="price_unit"/>
                                    <field name="price_subtotal" readonly="1"/>
                                </list>
                            </field>
                        </page>


                        <page string="Other Info">
                            <field name="note"/>
                        </page>
                    </notebook>

                    <div class="mt16 text-end">
                        <label string="Total:" for="amount_total"/>
                        <field name="amount_total" widget="monetary"
                               options="{'currency_field': 'currency_id'}"
                               readonly="1" class="oe_subtotal_footer"/>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- List View -->
    <record id="view_list_consignment_order" model="ir.ui.view">
        <field name="name">consignment.order.list</field>
        <field name="model">consignment.order</field>
        <field name="arch" type="xml">
            <list string="Consignment Orders" default_order="date_order desc">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="date_order"/>
                <field name="amount_total"/>
                <field name="company_id" readonly="1"/>
                <field name="state" widget="badge"
                       decoration-muted="state == 'draft'"
                       decoration-info="state == 'confirmed'"
                       decoration-success="state == 'done'"
                       decoration-danger="state == 'cancel'"/>
            </list>
        </field>
    </record>

    <!-- Order Line List View -->
    <record id="view_list_consignment_order_line" model="ir.ui.view">
        <field name="name">consignment.order.line.list</field>
        <field name="model">consignment.order.line</field>
        <field name="arch" type="xml">
            <list>
                <field name="product_id"/>
                <field name="product_uom_qty"/>
                <field name="price_unit"/>
                <field name="price_subtotal"/>
            </list>
        </field>
    </record>

    <!-- Action -->
    <record id="action_consignment_order" model="ir.actions.act_window">
        <field name="name">Consignment</field>
        <field name="res_model">consignment.order</field>
        <field name="view_mode">list,form</field>
        <field name="view_id" ref="view_list_consignment_order"/>
    </record>

    <record id="consignment_order_rule_multi_company" model="ir.rule">
        <field name="name">Consignment Order multi-company</field>
        <field name="model_id" ref="model_consignment_order"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="groups" eval="[(4, ref('base.group_user'))]"/>
    </record>


    <!-- Menu -->
    <menuitem id="menu_consignment_orders" name="Consignment"
              parent="sale.sale_order_menu"
              action="action_consignment_order"/>

    <record id="view_order_form_inherit_consignment" model="ir.ui.view">
        <field name="name">sale.order.form.inherit.consignment</field>
        <field name="model">sale.order</field>
        <field name="inherit_id" ref="sale.view_order_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='partner_id']" position="after">
                <field name="consignment_id"
                       options="{'no_create': True}"
                       domain="[('company_id', '=', company_id)]"
                       context="{'search_default_order_desc': True}"/>
            </xpath>
        </field>
    </record>

</odoo>
